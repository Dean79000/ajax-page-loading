/* ajaxPageLoading - v1.1  Copyright 2016-2018 Dean79000
 * https://github.com/Dean79000/ajax-page-loading
 * Under GNU GENERAL PUBLIC LICENSE Version 3 */
const APL={loader:null,container:null,callback:null,failCallback:null,setFailCallback:function(a){this.failCallback=a},setCallback:function(a){this.callback=a},setLoader:function(a){this.loader=a},setContainer:function(a){this.container=a},loadAjax:function(a,b,c){a.startsWith('/')||(a='/'+a),null!=this.loader&&(this.loader.style.display='block');const d=new XMLHttpRequest;d.onreadystatechange=function(){if(!(4>d.readyState)){if(200!==d.status){if(null!=APL.failCallback){const e=JSON.parse(d.responseText);APL.failCallback(a,e)}return void(null!=APL.loader&&(APL.loader.style.display='none'))}if(4===d.readyState){null!=b&&null!=c&&history.pushState(a,b,c);const e=JSON.parse(d.responseText);APL.container.innerHTML=e.view,null!=APL.callback&&APL.callback(a,e.params),APL.addListener(),document.getElementById(APL.container).innerHTML=d.responseText,null!=APL.loader&&(APL.loader.style.display='none')}}},d.open('GET',a,!0),d.setRequestHeader('Accept','application/json'),d.send()},clickHandler:function(a){let b,c=a.currentTarget.getAttribute('href');if(-1===c.indexOf('/')||c.startsWith('./')){let d=window.location.pathname;c.startsWith('./')&&(c=c.substr(2)),d.endsWith('/')||(d+='/'),b=d+c}else b=a.currentTarget.getAttribute('href');return APL.loadAjax(b,a.currentTarget.textContent,a.currentTarget.href),window.onpopstate=function(d){null==d.state?APL.loadAjax('/'):APL.loadAjax(d.state)},a.preventDefault()},addListener:function(){const a=document.getElementsByTagName('a');for(let b=0,c=a.length;b<c;b++)if(!(a[b].hasAttribute('target')&&'_parent'!==a[b].getAttribute('target')&&'_self'!==a[b].getAttribute('target'))){const d=a[b].hasAttribute('href');if(d&&(!d||0!==a[b].getAttribute('href').indexOf('#'))){const e=a[b].getAttribute('href').split('/');0<e.length&&0===e.pop().indexOf('#')||(a[b].removeEventListener('click',this.clickHandler),a[b].addEventListener('click',this.clickHandler))}}}};(function(){APL.addListener()})();